import React, { useState, useEffect } from 'react';
import { Trophy, BarChart3, ShoppingBag, Zap, Gift, TrendingUp, Moon, Sun, Sparkles, Award, Gem, Rocket } from 'lucide-react';

const DiamondCapitalist = () => {
  const [cash, setCash] = useState(0);
  const [totalEarned, setTotalEarned] = useState(0);
  const [allTimeEarned, setAllTimeEarned] = useState(0);
  const [investors, setInvestors] = useState(0);
  const [lastUpdate, setLastUpdate] = useState(Date.now());
  const [buyMultiplier, setBuyMultiplier] = useState(1);
  const [speedBoost, setSpeedBoost] = useState(1);
  const [speedBoostEnd, setSpeedBoostEnd] = useState(0);
  const [showStats, setShowStats] = useState(false);
  const [showAchievements, setShowAchievements] = useState(false);
  const [selectedSuit, setSelectedSuit] = useState(0);
  const [autoManager, setAutoManager] = useState(false);
  const [lastLogin, setLastLogin] = useState(Date.now());
  const [dailyBonusClaimed, setDailyBonusClaimed] = useState(false);
  const [showDailyBonus, setShowDailyBonus] = useState(false);
  const [darkMode, setDarkMode] = useState(true);
  
  // Late game features
  const [diamonds, setDiamonds] = useState(0);
  const [showPrestige, setShowPrestige] = useState(false);
  const [showMilestones, setShowMilestones] = useState(false);
  const [autoBuyerEnabled, setAutoBuyerEnabled] = useState(false);
  const [autoUpgradeEnabled, setAutoUpgradeEnabled] = useState(false);
  
  // Random Events System
  const [currentEvent, setCurrentEvent] = useState(null);
  const [eventEndTime, setEventEndTime] = useState(0);
  const [lastEventTime, setLastEventTime] = useState(Date.now());
  const [nextFreeBusiness, setNextFreeBusiness] = useState(false);

  const events = [
    { 
      id: 'diamond_rush', 
      name: 'ðŸ’Ž Diamond Rush!', 
      description: '3Ã— profit for 45 seconds',
      duration: 45000,
      effect: 'profit_multiplier',
      multiplier: 3
    },
    { 
      id: 'flash_sale', 
      name: 'ðŸ·ï¸ Flash Sale!', 
      description: '50% off all upgrades for 60 seconds',
      duration: 60000,
      effect: 'upgrade_discount',
      discount: 0.5
    },
    { 
      id: 'golden_opportunity', 
      name: 'âœ¨ Golden Opportunity!', 
      description: 'Next business purchase is FREE',
      duration: 90000,
      effect: 'free_business'
    },
    { 
      id: 'investor_meeting', 
      name: 'ðŸ‘¼ Investor Meeting!', 
      description: 'Double angel progress for 2 minutes',
      duration: 120000,
      effect: 'angel_boost',
      multiplier: 2
    },
    { 
      id: 'speed_event', 
      name: 'âš¡ Turbo Mode!', 
      description: '2Ã— speed for 90 seconds',
      duration: 90000,
      effect: 'speed_boost'
    },
    { 
      id: 'cash_windfall', 
      name: 'ðŸ’° Cash Windfall!', 
      description: 'Instant bonus equal to 30 seconds of production',
      duration: 0,
      effect: 'instant_cash'
    }
  ];

  const [businesses, setBusinesses] = useState([
    { 
      id: 1, name: 'Diamond Mine', icon: 'ðŸ’Ž', owned: 1, baseCost: 4, costMultiplier: 1.07,
      baseRevenue: 1, baseTime: 1000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 1000, managerName: 'Miner Mike',
      unlockCash: 0, unlocked: true, totalProfit: 0
    },
    { 
      id: 2, name: 'Diamond Quarry', icon: 'â›ï¸', owned: 0, baseCost: 60, costMultiplier: 1.07,
      baseRevenue: 60, baseTime: 3000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 15000, managerName: 'Quarry Quinn',
      unlockCash: 100, unlocked: false, totalProfit: 0
    },
    { 
      id: 3, name: 'Diamond Refinery', icon: 'ðŸ­', owned: 0, baseCost: 720, costMultiplier: 1.07,
      baseRevenue: 540, baseTime: 6000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 100000, managerName: 'Refiner Rachel',
      unlockCash: 500, unlocked: false, totalProfit: 0
    },
    { 
      id: 4, name: 'Diamond Jewelry', icon: 'ðŸ’', owned: 0, baseCost: 8640, costMultiplier: 1.07,
      baseRevenue: 4320, baseTime: 12000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 500000, managerName: 'Jeweler James',
      unlockCash: 2500, unlocked: false, totalProfit: 0
    },
    { 
      id: 5, name: 'Diamond Bank', icon: 'ðŸ¦', owned: 0, baseCost: 103680, costMultiplier: 1.07,
      baseRevenue: 51840, baseTime: 24000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 1200000, managerName: 'Banker Bob',
      unlockCash: 15000, unlocked: false, totalProfit: 0
    },
    { 
      id: 6, name: 'Diamond Cruise', icon: 'ðŸš¢', owned: 0, baseCost: 1244160, costMultiplier: 1.07,
      baseRevenue: 622080, baseTime: 36000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 10000000, managerName: 'Captain Carl',
      unlockCash: 3000000, unlocked: false, totalProfit: 0
    },
    { 
      id: 7, name: 'Diamond Casino', icon: 'ðŸŽ°', owned: 0, baseCost: 14929920, costMultiplier: 1.07,
      baseRevenue: 7464960, baseTime: 48000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 50000000, managerName: 'Dealer Dana',
      unlockCash: 40000000, unlocked: false, totalProfit: 0
    },
    { 
      id: 8, name: 'Diamond Park', icon: 'ðŸŽ¢', owned: 0, baseCost: 179159040, costMultiplier: 1.07,
      baseRevenue: 89579520, baseTime: 72000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 250000000, managerName: 'Park Manager Pat',
      unlockCash: 500000000, unlocked: false, totalProfit: 0
    },
    { 
      id: 9, name: 'Diamond Station', icon: 'ðŸ›¸', owned: 0, baseCost: 2149908480, costMultiplier: 1.07,
      baseRevenue: 1074954240, baseTime: 96000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 1000000000, managerName: 'Astronaut Alex',
      unlockCash: 6000000000, unlocked: false, totalProfit: 0
    },
    { 
      id: 10, name: 'Diamond Planet', icon: 'ðŸª', owned: 0, baseCost: 25798901760, costMultiplier: 1.07,
      baseRevenue: 12899450880, baseTime: 144000, progress: 0, isRunning: false,
      hasManager: false, managerCost: 10000000000, managerName: 'Planet Governor',
      unlockCash: 75000000000, unlocked: false, totalProfit: 0
    },
  ]);

  const [prestigeUpgrades, setPrestigeUpgrades] = useState([
    { id: 'p1', name: 'Angel Power', description: '+50% Angel Bonus', cost: 10, bought: false, multiplier: 1.5 },
    { id: 'p2', name: 'Faster Production', description: 'All businesses 20% faster', cost: 25, bought: false, speedBoost: 1.2 },
    { id: 'p3', name: 'Mega Profits', description: '2Ã— All Profits', cost: 50, bought: false, multiplier: 2 },
    { id: 'p4', name: 'Diamond Vision', description: '+1 ðŸ’Ž per Angel reset', cost: 75, bought: false },
    { id: 'p5', name: 'Auto Manager', description: 'Auto-hire managers (keep)', cost: 100, bought: false },
    { id: 'p6', name: 'Super Angels', description: '3Ã— Angel Bonus', cost: 150, bought: false, multiplier: 3 },
    { id: 'p7', name: 'Hyper Speed', description: 'All businesses 50% faster', cost: 200, bought: false, speedBoost: 1.5 },
    { id: 'p8', name: 'Profit Explosion', description: '5Ã— All Profits', cost: 300, bought: false, multiplier: 5 },
    { id: 'p9', name: 'Diamond Rain', description: '+3 ðŸ’Ž per Angel reset', cost: 500, bought: false },
    { id: 'p10', name: 'Auto Buyer', description: 'Auto-buy businesses (keep)', cost: 750, bought: false },
  ]);

  const [megaMilestones, setMegaMilestones] = useState([
    { id: 'm1', name: 'First Million', goal: 1000000, reward: 1, claimed: false, type: 'cash' },
    { id: 'm2', name: 'Ten Million Club', goal: 10000000, reward: 2, claimed: false, type: 'cash' },
    { id: 'm3', name: 'Hundred Million Empire', goal: 100000000, reward: 3, claimed: false, type: 'cash' },
    { id: 'm4', name: 'Billionaire Status', goal: 1000000000, reward: 5, claimed: false, type: 'cash' },
    { id: 'm5', name: 'Ten Billion Tycoon', goal: 10000000000, reward: 7, claimed: false, type: 'cash' },
    { id: 'm6', name: 'Hundred Billion Mogul', goal: 100000000000, reward: 10, claimed: false, type: 'cash' },
    { id: 'm7', name: 'Trillion Dollar Dream', goal: 1000000000000, reward: 15, claimed: false, type: 'cash' },
    { id: 'm8', name: 'Angel Investor', goal: 50, reward: 5, claimed: false, type: 'angels' },
    { id: 'm9', name: 'Angel Army', goal: 100, reward: 10, claimed: false, type: 'angels' },
    { id: 'm10', name: 'Angel Legion', goal: 250, reward: 20, claimed: false, type: 'angels' },
  ]);

  const [diamondUpgrades, setDiamondUpgrades] = useState([
    { id: 'd1', name: 'Diamond Boost', description: '2Ã— ALL Profits (Permanent)', cost: 5, bought: false, multiplier: 2 },
    { id: 'd2', name: 'Time Warp', description: 'All businesses 2Ã— faster (Permanent)', cost: 10, bought: false, speedBoost: 2 },
    { id: 'd3', name: 'Angel Magnet', description: 'Angels give 2Ã— bonus (Permanent)', cost: 15, bought: false, angelMultiplier: 2 },
    { id: 'd4', name: 'Super Diamond Boost', description: '5Ã— ALL Profits (Permanent)', cost: 25, bought: false, multiplier: 5 },
    { id: 'd5', name: 'Quantum Speed', description: 'All businesses 5Ã— faster (Permanent)', cost: 40, bought: false, speedBoost: 5 },
    { id: 'd6', name: 'Mega Multiplier', description: '10Ã— ALL Profits (Permanent)', cost: 75, bought: false, multiplier: 10 },
    { id: 'd7', name: 'Auto Everything', description: 'Auto-buy & Auto-upgrade (Permanent)', cost: 100, bought: false },
  ]);

  const [upgrades, setUpgrades] = useState([
    // Mine upgrades
    { id: 'u1', name: 'Steel Pickaxes', description: '2x Mine', businessId: 1, requiredCount: 10, cost: 10000, bought: false, multiplier: 2, unlockCash: 0, unlocked: true },
    { id: 'u2', name: 'Better Tools', description: '2x Mine', businessId: 1, requiredCount: 25, cost: 50000, bought: false, multiplier: 2, unlockCash: 25000, unlocked: false },
    { id: 'u3', name: 'Deep Mining', description: '2x Mine', businessId: 1, requiredCount: 50, cost: 250000, bought: false, multiplier: 2, unlockCash: 100000, unlocked: false },
    { id: 'u4', name: 'Diamond Drills', description: '2x Mine', businessId: 1, requiredCount: 75, cost: 1000000, bought: false, multiplier: 2, unlockCash: 500000, unlocked: false },
    { id: 'u5', name: 'Mega Drills', description: '3x Mine', businessId: 1, requiredCount: 100, cost: 5000000, bought: false, multiplier: 3, unlockCash: 2000000, unlocked: false },
    { id: 'u6', name: 'Sonic Drills', description: '2x Mine', businessId: 1, requiredCount: 150, cost: 25000000, bought: false, multiplier: 2, unlockCash: 10000000, unlocked: false },
    { id: 'u7', name: 'Laser Mining', description: '2x Mine', businessId: 1, requiredCount: 200, cost: 100000000, bought: false, multiplier: 2, unlockCash: 50000000, unlocked: false },
    { id: 'u8', name: 'Plasma Mining', description: '3x Mine', businessId: 1, requiredCount: 250, cost: 500000000, bought: false, multiplier: 3, unlockCash: 250000000, unlocked: false },
    { id: 'u9', name: 'Quantum Mining', description: '2x Mine', businessId: 1, requiredCount: 300, cost: 2000000000, bought: false, multiplier: 2, unlockCash: 1000000000, unlocked: false },
    { id: 'u10', name: 'Infinite Mine', description: '5x Mine', businessId: 1, requiredCount: 400, cost: 10000000000, bought: false, multiplier: 5, unlockCash: 5000000000, unlocked: false },
    
    // Quarry upgrades
    { id: 'u11', name: 'TNT', description: '2x Quarry', businessId: 2, requiredCount: 10, cost: 100000, bought: false, multiplier: 2, unlockCash: 50000, unlocked: false },
    { id: 'u12', name: 'Excavators', description: '2x Quarry', businessId: 2, requiredCount: 25, cost: 500000, bought: false, multiplier: 2, unlockCash: 250000, unlocked: false },
    { id: 'u13', name: 'Explosives', description: '2x Quarry', businessId: 2, requiredCount: 50, cost: 2500000, bought: false, multiplier: 2, unlockCash: 1000000, unlocked: false },
    { id: 'u14', name: 'Mega Bombs', description: '2x Quarry', businessId: 2, requiredCount: 75, cost: 10000000, bought: false, multiplier: 2, unlockCash: 5000000, unlocked: false },
    { id: 'u15', name: 'Nuclear Charges', description: '3x Quarry', businessId: 2, requiredCount: 100, cost: 50000000, bought: false, multiplier: 3, unlockCash: 25000000, unlocked: false },
    { id: 'u16', name: 'Antimatter Explosives', description: '2x Quarry', businessId: 2, requiredCount: 150, cost: 250000000, bought: false, multiplier: 2, unlockCash: 100000000, unlocked: false },
    { id: 'u17', name: 'Singularity Bombs', description: '2x Quarry', businessId: 2, requiredCount: 200, cost: 1000000000, bought: false, multiplier: 2, unlockCash: 500000000, unlocked: false },
    { id: 'u18', name: 'Reality Breakers', description: '3x Quarry', businessId: 2, requiredCount: 250, cost: 5000000000, bought: false, multiplier: 3, unlockCash: 2500000000, unlocked: false },
    { id: 'u19', name: 'Dimension Shatterers', description: '2x Quarry', businessId: 2, requiredCount: 300, cost: 20000000000, bought: false, multiplier: 2, unlockCash: 10000000000, unlocked: false },
    { id: 'u20', name: 'Universe Splitters', description: '5x Quarry', businessId: 2, requiredCount: 400, cost: 100000000000, bought: false, multiplier: 5, unlockCash: 50000000000, unlocked: false },
    
    // Refinery upgrades
    { id: 'u21', name: 'Precision Cutting', description: '2x Refinery', businessId: 3, requiredCount: 10, cost: 1000000, bought: false, multiplier: 2, unlockCash: 500000, unlocked: false },
    { id: 'u22', name: 'Laser Polish', description: '2x Refinery', businessId: 3, requiredCount: 25, cost: 5000000, bought: false, multiplier: 2, unlockCash: 2500000, unlocked: false },
    { id: 'u23', name: 'Perfect Facets', description: '2x Refinery', businessId: 3, requiredCount: 50, cost: 25000000, bought: false, multiplier: 2, unlockCash: 10000000, unlocked: false },
    { id: 'u24', name: 'Molecular Polish', description: '2x Refinery', businessId: 3, requiredCount: 75, cost: 100000000, bought: false, multiplier: 2, unlockCash: 50000000, unlocked: false },
    { id: 'u25', name: 'Atomic Refinement', description: '3x Refinery', businessId: 3, requiredCount: 100, cost: 500000000, bought: false, multiplier: 3, unlockCash: 250000000, unlocked: false },
    { id: 'u26', name: 'Quantum Polish', description: '2x Refinery', businessId: 3, requiredCount: 150, cost: 2500000000, bought: false, multiplier: 2, unlockCash: 1000000000, unlocked: false },
    { id: 'u27', name: 'Hyperdimensional Cut', description: '3x Refinery', businessId: 3, requiredCount: 200, cost: 10000000000, bought: false, multiplier: 3, unlockCash: 5000000000, unlocked: false },
    { id: 'u28', name: 'Perfect Gems', description: '5x Refinery', businessId: 3, requiredCount: 300, cost: 100000000000, bought: false, multiplier: 5, unlockCash: 50000000000, unlocked: false },
    
    // Jewelry upgrades
    { id: 'u29', name: 'Celebrity Ads', description: '2x Jewelry', businessId: 4, requiredCount: 10, cost: 10000000, bought: false, multiplier: 2, unlockCash: 5000000, unlocked: false },
    { id: 'u30', name: 'Fashion Shows', description: '2x Jewelry', businessId: 4, requiredCount: 25, cost: 50000000, bought: false, multiplier: 2, unlockCash: 25000000, unlocked: false },
    { id: 'u31', name: 'Exclusive Line', description: '2x Jewelry', businessId: 4, requiredCount: 50, cost: 250000000, bought: false, multiplier: 2, unlockCash: 100000000, unlocked: false },
    { id: 'u32', name: 'Royal Collection', description: '2x Jewelry', businessId: 4, requiredCount: 75, cost: 1000000000, bought: false, multiplier: 2, unlockCash: 500000000, unlocked: false },
    { id: 'u33', name: 'Legendary Pieces', description: '3x Jewelry', businessId: 4, requiredCount: 100, cost: 5000000000, bought: false, multiplier: 3, unlockCash: 2500000000, unlocked: false },
    { id: 'u34', name: 'Mythical Jewelry', description: '2x Jewelry', businessId: 4, requiredCount: 150, cost: 25000000000, bought: false, multiplier: 2, unlockCash: 10000000000, unlocked: false },
    { id: 'u35', name: 'Divine Craftsmanship', description: '3x Jewelry', businessId: 4, requiredCount: 200, cost: 100000000000, bought: false, multiplier: 3, unlockCash: 50000000000, unlocked: false },
    { id: 'u36', name: 'Cosmic Jewelry', description: '5x Jewelry', businessId: 4, requiredCount: 300, cost: 1000000000000, bought: false, multiplier: 5, unlockCash: 500000000000, unlocked: false },
    
    // Bank upgrades
    { id: 'u37', name: 'Security Upgrade', description: '2x Bank', businessId: 5, requiredCount: 25, cost: 500000000, bought: false, multiplier: 2, unlockCash: 250000000, unlocked: false },
    { id: 'u38', name: 'Investment Fund', description: '2x Bank', businessId: 5, requiredCount: 50, cost: 2500000000, bought: false, multiplier: 2, unlockCash: 1000000000, unlocked: false },
    { id: 'u39', name: 'Hedge Funds', description: '2x Bank', businessId: 5, requiredCount: 75, cost: 10000000000, bought: false, multiplier: 2, unlockCash: 5000000000, unlocked: false },
    { id: 'u40', name: 'Crypto Trading', description: '3x Bank', businessId: 5, requiredCount: 100, cost: 50000000000, bought: false, multiplier: 3, unlockCash: 25000000000, unlocked: false },
    { id: 'u41', name: 'Global Banking', description: '2x Bank', businessId: 5, requiredCount: 150, cost: 250000000000, bought: false, multiplier: 2, unlockCash: 100000000000, unlocked: false },
    { id: 'u42', name: 'Galactic Finance', description: '5x Bank', businessId: 5, requiredCount: 200, cost: 1000000000000, bought: false, multiplier: 5, unlockCash: 500000000000, unlocked: false },
    
    // Cruise upgrades
    { id: 'u43', name: 'Luxury Suites', description: '2x Cruise', businessId: 6, requiredCount: 25, cost: 5000000000, bought: false, multiplier: 2, unlockCash: 2500000000, unlocked: false },
    { id: 'u44', name: 'Michelin Chefs', description: '2x Cruise', businessId: 6, requiredCount: 50, cost: 25000000000, bought: false, multiplier: 2, unlockCash: 10000000000, unlocked: false },
    { id: 'u45', name: 'Private Islands', description: '3x Cruise', businessId: 6, requiredCount: 100, cost: 100000000000, bought: false, multiplier: 3, unlockCash: 50000000000, unlocked: false },
    { id: 'u46', name: 'Underwater Tours', description: '2x Cruise', businessId: 6, requiredCount: 150, cost: 500000000000, bought: false, multiplier: 2, unlockCash: 250000000000, unlocked: false },
    { id: 'u47', name: 'Space Cruises', description: '5x Cruise', businessId: 6, requiredCount: 200, cost: 5000000000000, bought: false, multiplier: 5, unlockCash: 2500000000000, unlocked: false },
    
    // Casino upgrades
    { id: 'u48', name: 'VIP Tables', description: '2x Casino', businessId: 7, requiredCount: 25, cost: 50000000000, bought: false, multiplier: 2, unlockCash: 25000000000, unlocked: false },
    { id: 'u49', name: 'High Roller Suite', description: '2x Casino', businessId: 7, requiredCount: 50, cost: 250000000000, bought: false, multiplier: 2, unlockCash: 100000000000, unlocked: false },
    { id: 'u50', name: 'Golden Cards', description: '3x Casino', businessId: 7, requiredCount: 100, cost: 1000000000000, bought: false, multiplier: 3, unlockCash: 500000000000, unlocked: false },
    { id: 'u51', name: 'Diamond Chips', description: '2x Casino', businessId: 7, requiredCount: 150, cost: 5000000000000, bought: false, multiplier: 2, unlockCash: 2500000000000, unlocked: false },
    { id: 'u52', name: 'Luck Manipulation', description: '5x Casino', businessId: 7, requiredCount: 200, cost: 50000000000000, bought: false, multiplier: 5, unlockCash: 25000000000000, unlocked: false },
    
    // Park upgrades
    { id: 'u53', name: 'New Rides', description: '2x Park', businessId: 8, requiredCount: 25, cost: 500000000000, bought: false, multiplier: 2, unlockCash: 250000000000, unlocked: false },
    { id: 'u54', name: 'Extreme Coasters', description: '2x Park', businessId: 8, requiredCount: 50, cost: 2500000000000, bought: false, multiplier: 2, unlockCash: 1000000000000, unlocked: false },
    { id: 'u55', name: 'VR Experiences', description: '3x Park', businessId: 8, requiredCount: 100, cost: 10000000000000, bought: false, multiplier: 3, unlockCash: 5000000000000, unlocked: false },
    { id: 'u56', name: 'Reality-Bending Rides', description: '5x Park', businessId: 8, requiredCount: 150, cost: 100000000000000, bought: false, multiplier: 5, unlockCash: 50000000000000, unlocked: false },
    
    // Station upgrades
    { id: 'u57', name: 'Zero-G Labs', description: '2x Station', businessId: 9, requiredCount: 25, cost: 5000000000000, bought: false, multiplier: 2, unlockCash: 2500000000000, unlocked: false },
    { id: 'u58', name: 'Warp Drive', description: '3x Station', businessId: 9, requiredCount: 50, cost: 25000000000000, bought: false, multiplier: 3, unlockCash: 10000000000000, unlocked: false },
    { id: 'u59', name: 'Time Dilation', description: '5x Station', businessId: 9, requiredCount: 100, cost: 100000000000000, bought: false, multiplier: 5, unlockCash: 50000000000000, unlocked: false },
    
    // Planet upgrades
    { id: 'u60', name: 'Terraforming', description: '2x Planet', businessId: 10, requiredCount: 25, cost: 50000000000000, bought: false, multiplier: 2, unlockCash: 25000000000000, unlocked: false },
    { id: 'u61', name: 'Atmosphere Generator', description: '3x Planet', businessId: 10, requiredCount: 50, cost: 250000000000000, bought: false, multiplier: 3, unlockCash: 100000000000000, unlocked: false },
    { id: 'u62', name: 'Planetary Core', description: '5x Planet', businessId: 10, requiredCount: 100, cost: 1000000000000000, bought: false, multiplier: 5, unlockCash: 500000000000000, unlocked: false },
    
    // Global upgrades
    { id: 'u63', name: 'Marketing Campaign', description: '2x ALL', businessId: 0, requiredCount: 0, cost: 10000000, bought: false, multiplier: 2, unlockCash: 5000000, unlocked: false },
    { id: 'u64', name: 'Brand Recognition', description: '2x ALL', businessId: 0, requiredCount: 0, cost: 100000000, bought: false, multiplier: 2, unlockCash: 50000000, unlocked: false },
    { id: 'u65', name: 'Global Expansion', description: '2x ALL', businessId: 0, requiredCount: 0, cost: 1000000000, bought: false, multiplier: 2, unlockCash: 500000000, unlocked: false },
    { id: 'u66', name: 'Diamond Empire', description: '2x ALL', businessId: 0, requiredCount: 0, cost: 10000000000, bought: false, multiplier: 2, unlockCash: 5000000000, unlocked: false },
    { id: 'u67', name: 'Market Dominance', description: '3x ALL', businessId: 0, requiredCount: 0, cost: 100000000000, bought: false, multiplier: 3, unlockCash: 50000000000, unlocked: false },
    { id: 'u68', name: 'Diamond Monopoly', description: '2x ALL', businessId: 0, requiredCount: 0, cost: 1000000000000, bought: false, multiplier: 2, unlockCash: 500000000000, unlocked: false },
    { id: 'u69', name: 'Universal Control', description: '3x ALL', businessId: 0, requiredCount: 0, cost: 10000000000000, bought: false, multiplier: 3, unlockCash: 5000000000000, unlocked: false },
    { id: 'u70', name: 'Reality Ownership', description: '5x ALL', businessId: 0, requiredCount: 0, cost: 100000000000000, bought: false, multiplier: 5, unlockCash: 50000000000000, unlocked: false },
  ]);

  const [achievements, setAchievements] = useState([
    { id: 'a1', name: 'First Click', description: 'Make $100', requirement: 100, type: 'cash', claimed: false, reward: 1.05 },
    { id: 'a2', name: 'Getting Started', description: 'Make $10K', requirement: 10000, type: 'cash', claimed: false, reward: 1.05 },
    { id: 'a3', name: 'Getting Rich', description: 'Make $100K', requirement: 100000, type: 'cash', claimed: false, reward: 1.05 },
    { id: 'a4', name: 'Millionaire', description: 'Make $1M', requirement: 1000000, type: 'cash', claimed: false, reward: 1.1 },
    { id: 'a5', name: 'Multi-Millionaire', description: 'Make $100M', requirement: 100000000, type: 'cash', claimed: false, reward: 1.1 },
    { id: 'a6', name: 'Billionaire', description: 'Make $1B', requirement: 1000000000, type: 'cash', claimed: false, reward: 1.15 },
    { id: 'a7', name: 'Trillionaire', description: 'Make $1T', requirement: 1000000000000, type: 'cash', claimed: false, reward: 1.2 },
    { id: 'a8', name: 'Mine Master', description: '100 Mines', requirement: 100, type: 'business', businessId: 1, claimed: false, reward: 1.1 },
    { id: 'a9', name: 'Mine Legend', description: '250 Mines', requirement: 250, type: 'business', businessId: 1, claimed: false, reward: 1.15 },
    { id: 'a10', name: 'Full Staff', description: 'All managers', requirement: 10, type: 'managers', claimed: false, reward: 1.2 },
    { id: 'a11', name: 'Upgrade Novice', description: '10 upgrades', requirement: 10, type: 'upgrades', claimed: false, reward: 1.1 },
    { id: 'a12', name: 'Upgrade Expert', description: '25 upgrades', requirement: 25, type: 'upgrades', claimed: false, reward: 1.15 },
    { id: 'a13', name: 'Upgrade Master', description: '50 upgrades', requirement: 50, type: 'upgrades', claimed: false, reward: 1.2 },
    { id: 'a14', name: 'Angel Novice', description: '5 Angels', requirement: 5, type: 'angels', claimed: false, reward: 1.1 },
    { id: 'a15', name: 'Angel Master', description: '25 Angels', requirement: 25, type: 'angels', claimed: false, reward: 1.2 },
  ]);

  const [suits, setSuits] = useState([
    { id: 0, name: 'Basic Suit', icon: 'ðŸ‘”', bonus: 1, cost: 0, owned: true },
    { id: 1, name: 'Power Suit', icon: 'ðŸŽ©', bonus: 1.5, cost: 100000000, owned: false },
    { id: 2, name: 'Diamond Suit', icon: 'ðŸ’Ž', bonus: 2, cost: 10000000000, owned: false },
    { id: 3, name: 'Royal Suit', icon: 'ðŸ‘‘', bonus: 3, cost: 1000000000000, owned: false },
    { id: 4, name: 'Cosmic Suit', icon: 'âœ¨', bonus: 5, cost: 100000000000000, owned: false },
  ]);

  // Auto-buyer logic
  useEffect(() => {
    if (autoBuyerEnabled || diamondUpgrades.find(d => d.id === 'd7')?.bought) {
      const interval = setInterval(() => {
        businesses.forEach(business => {
          if (business.unlocked && business.owned < 1000) {
            const cost = getBusinessCost(business, 1);
            if (cash >= cost * 10) { // Only auto-buy if we have 10x the cost
              buyBusiness(business.id);
            }
          }
        });
      }, 1000);
      return () => clearInterval(interval);
    }
  }, [autoBuyerEnabled, cash, businesses, diamondUpgrades]);

  // Auto-upgrade logic
  useEffect(() => {
    if (autoUpgradeEnabled || diamondUpgrades.find(d => d.id === 'd7')?.bought) {
      const interval = setInterval(() => {
        upgrades.forEach(upgrade => {
          if (!upgrade.bought && upgrade.unlocked && (upgrade.businessId === 0 || businesses.find(b => b.id === upgrade.businessId)?.owned >= upgrade.requiredCount)) {
            if (cash >= upgrade.cost * 5) { // Only auto-buy if we have 5x the cost
              buyUpgrade(upgrade.id);
            }
          }
        });
      }, 2000);
      return () => clearInterval(interval);
    }
  }, [autoUpgradeEnabled, cash, upgrades, businesses, diamondUpgrades]);

  // Check mega milestones
  useEffect(() => {
    setMegaMilestones(prev => prev.map(milestone => {
      if (milestone.claimed) return milestone;
      let completed = false;
      if (milestone.type === 'cash') {
        completed = allTimeEarned >= milestone.goal;
      } else if (milestone.type === 'angels') {
        completed = investors >= milestone.goal;
      }
      if (completed && !milestone.claimed) {
        setDiamonds(d => d + milestone.reward);
        return { ...milestone, claimed: true };
      }
      return milestone;
    }));
  }, [allTimeEarned, investors]);

  // Random Events Logic
  useEffect(() => {
    const now = Date.now();
    
    // Trigger random events every 60-180 seconds
    if (now - lastEventTime > 90000 + Math.random() * 90000) {
      triggerRandomEvent();
    }
    
    // Check if current event has expired
    if (currentEvent && eventEndTime > 0 && now >= eventEndTime) {
      setCurrentEvent(null);
      setEventEndTime(0);
    }
  }, [lastUpdate]);

  const triggerRandomEvent = () => {
    const randomEvent = events[Math.floor(Math.random() * events.length)];
    setCurrentEvent(randomEvent);
    
    if (randomEvent.effect === 'instant_cash') {
      // Calculate 30 seconds of production
      const instantCash = totalProfitPerSecond * 30;
      setCash(prev => prev + instantCash);
      setTotalEarned(prev => prev + instantCash);
      setAllTimeEarned(prev => prev + instantCash);
      setCurrentEvent(null);
      setEventEndTime(0);
    } else if (randomEvent.effect === 'free_business') {
      setNextFreeBusiness(true);
      setEventEndTime(Date.now() + randomEvent.duration);
    } else if (randomEvent.effect === 'speed_boost') {
      setSpeedBoost(2);
      setSpeedBoostEnd(Date.now() + randomEvent.duration);
      setEventEndTime(Date.now() + randomEvent.duration);
    } else {
      setEventEndTime(Date.now() + randomEvent.duration);
    }
    
    setLastEventTime(Date.now());
  };

  useEffect(() => {
    const daysSinceLastLogin = Math.floor((Date.now() - lastLogin) / (1000 * 60 * 60 * 24));
    if (daysSinceLastLogin >= 1 && !dailyBonusClaimed) {
      setShowDailyBonus(true);
    }
  }, []);

  const claimDailyBonus = () => {
    const bonus = Math.floor(cash * 0.5 + 10000);
    setCash(prev => prev + bonus);
    setDailyBonusClaimed(true);
    setShowDailyBonus(false);
    setLastLogin(Date.now());
  };

  const activateSpeedBoost = (duration = 60000) => {
    setSpeedBoost(2);
    setSpeedBoostEnd(Date.now() + duration);
  };

  useEffect(() => {
    if (speedBoostEnd > 0 && Date.now() >= speedBoostEnd) {
      setSpeedBoost(1);
      setSpeedBoostEnd(0);
    }
  }, [lastUpdate, speedBoostEnd]);

  // Enable auto-features from prestige upgrades
  useEffect(() => {
    if (prestigeUpgrades.find(p => p.id === 'p5')?.bought) {
      setAutoManager(true);
    }
    if (prestigeUpgrades.find(p => p.id === 'p10')?.bought) {
      setAutoBuyerEnabled(true);
    }
  }, [prestigeUpgrades]);

  const buyPrestigeUpgrade = (upgradeId) => {
    const upgrade = prestigeUpgrades.find(u => u.id === upgradeId);
    if (!upgrade.bought && investors >= upgrade.cost) {
      setInvestors(prev => prev - upgrade.cost);
      setPrestigeUpgrades(prev => prev.map(u => 
        u.id === upgradeId ? { ...u, bought: true } : u
      ));
    }
  };

  const buyDiamondUpgrade = (upgradeId) => {
    const upgrade = diamondUpgrades.find(u => u.id === upgradeId);
    if (!upgrade.bought && diamonds >= upgrade.cost) {
      setDiamonds(prev => prev - upgrade.cost);
      setDiamondUpgrades(prev => prev.map(u => 
        u.id === upgradeId ? { ...u, bought: true } : u
      ));
      if (upgradeId === 'd7') {
        setAutoBuyerEnabled(true);
        setAutoUpgradeEnabled(true);
      }
    }
  };

  const getBusinessCost = (business, amount = 1) => {
    if (nextFreeBusiness && currentEvent?.effect === 'free_business') {
      return 0;
    }
    if (amount === 1) return Math.floor(business.baseCost * Math.pow(business.costMultiplier, business.owned));
    let totalCost = 0;
    for (let i = 0; i < amount; i++) {
      totalCost += Math.floor(business.baseCost * Math.pow(business.costMultiplier, business.owned + i));
    }
    return totalCost;
  };
  
  const getMaxBuyAmount = (business) => {
    if (nextFreeBusiness && currentEvent?.effect === 'free_business') {
      return 1;
    }
    let amount = 0;
    let totalCost = 0;
    while (amount < 1000) {
      const nextCost = Math.floor(business.baseCost * Math.pow(business.costMultiplier, business.owned + amount));
      if (totalCost + nextCost > cash) break;
      totalCost += nextCost;
      amount++;
    }
    return amount;
  };

  const getBusinessRevenue = (business) => {
    if (business.owned === 0) return 0;
    let revenue = business.baseRevenue * business.owned;
    
    const milestones = [
      { count: 25, multiplier: 2 }, { count: 50, multiplier: 2 }, { count: 100, multiplier: 2 },
      { count: 200, multiplier: 2 }, { count: 300, multiplier: 2 }, { count: 400, multiplier: 2 },
      { count: 500, multiplier: 2 }, { count: 600, multiplier: 2 }, { count: 700, multiplier: 2 },
      { count: 800, multiplier: 2 }, { count: 900, multiplier: 2 }, { count: 1000, multiplier: 5 },
    ];
    milestones.forEach(milestone => {
      if (business.owned >= milestone.count) revenue *= milestone.multiplier;
    });
    
    upgrades.forEach(upgrade => {
      if (upgrade.bought && (upgrade.businessId === business.id || upgrade.businessId === 0)) {
        revenue *= upgrade.multiplier;
      }
    });
    
    let angelBonus = 1 + investors * 0.02;
    prestigeUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.multiplier) {
        angelBonus *= upgrade.multiplier;
      }
    });
    diamondUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.angelMultiplier) {
        angelBonus *= upgrade.angelMultiplier;
      }
    });
    revenue *= angelBonus;
    
    achievements.forEach(achievement => {
      if (achievement.claimed) revenue *= achievement.reward;
    });
    revenue *= suits.find(s => s.id === selectedSuit).bonus;
    
    // Apply prestige and diamond multipliers
    prestigeUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.multiplier && !upgrade.description.includes('Angel')) {
        revenue *= upgrade.multiplier;
      }
    });
    diamondUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.multiplier) {
        revenue *= upgrade.multiplier;
      }
    });
    
    // Apply event multiplier
    if (currentEvent?.effect === 'profit_multiplier' && eventEndTime > Date.now()) {
      revenue *= currentEvent.multiplier;
    }
    
    return revenue;
  };

  const getProductionTime = (business) => {
    let time = business.baseTime;
    if (business.owned >= 50) time = time / 2;
    if (business.owned >= 100) time = time / 2;
    time = time / speedBoost;
    
    // Apply prestige and diamond speed boosts
    prestigeUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.speedBoost) {
        time = time / upgrade.speedBoost;
      }
    });
    diamondUpgrades.forEach(upgrade => {
      if (upgrade.bought && upgrade.speedBoost) {
        time = time / upgrade.speedBoost;
      }
    });
    
    return time;
  };
  
  const getProfitPerSecond = (business) => {
    if (business.owned === 0 || !business.hasManager) return 0;
    const revenue = getBusinessRevenue(business);
    const timeInSeconds = getProductionTime(business) / 1000;
    return revenue / timeInSeconds;
  };

  const buyBusiness = (businessId) => {
    const business = businesses.find(b => b.id === businessId);
    if (!business.unlocked) return;
    
    const amount = buyMultiplier === 'MAX' ? getMaxBuyAmount(business) : buyMultiplier;
    const cost = getBusinessCost(business, amount);
    if (cash >= cost && amount > 0) {
      setCash(prev => prev - cost);
      setBusinesses(prev => prev.map(b => 
        b.id === businessId ? { ...b, owned: b.owned + amount } : b
      ));
      if (nextFreeBusiness && currentEvent?.effect === 'free_business') {
        setNextFreeBusiness(false);
        setCurrentEvent(null);
        setEventEndTime(0);
      }
    }
  };
  
  useEffect(() => {
    setBusinesses(prev => prev.map(b => {
      if (!b.unlocked && cash >= b.unlockCash) {
        return { ...b, unlocked: true };
      }
      return b;
    }));
  }, [cash]);

  // Unlock upgrades when reaching cash milestones
  useEffect(() => {
    setUpgrades(prev => prev.map(u => {
      if (!u.unlocked && allTimeEarned >= u.unlockCash) {
        return { ...u, unlocked: true };
      }
      return u;
    }));
  }, [allTimeEarned]);

  useEffect(() => {
    if (autoManager) {
      businesses.forEach(business => {
        if (!business.hasManager && business.owned > 0 && cash >= business.managerCost) {
          hireManager(business.id);
        }
      });
    }
  }, [cash, autoManager]);

  const hireManager = (businessId) => {
    const business = businesses.find(b => b.id === businessId);
    if (cash >= business.managerCost && !business.hasManager && business.owned > 0) {
      setCash(prev => prev - business.managerCost);
      setBusinesses(prev => prev.map(b => 
        b.id === businessId ? { ...b, hasManager: true } : b
      ));
    }
  };

  const clickBusiness = (businessId) => {
    const business = businesses.find(b => b.id === businessId);
    if (business.owned === 0) return;
    
    if (!business.isRunning && !business.hasManager) {
      setBusinesses(prev => prev.map(b => 
        b.id === businessId ? { ...b, isRunning: true, progress: 0 } : b
      ));
    }
  };

  useEffect(() => {
    const interval = setInterval(() => {
      const now = Date.now();
      const deltaTime = now - lastUpdate;
      setLastUpdate(now);
      
      setBusinesses(prev => prev.map(business => {
        if ((business.isRunning || business.hasManager) && business.owned > 0) {
          const productionTime = getProductionTime(business);
          
          if (productionTime < 1000 && business.hasManager) {
            const revenue = getBusinessRevenue(business);
            setCash(c => c + revenue);
            setTotalEarned(t => t + revenue);
            setAllTimeEarned(t => t + revenue);
            return { ...business, progress: 0, isRunning: true, totalProfit: business.totalProfit + revenue };
          }
          
          const newProgress = business.progress + deltaTime;
          
          if (newProgress >= productionTime) {
            const revenue = getBusinessRevenue(business);
            setCash(c => c + revenue);
            setTotalEarned(t => t + revenue);
            setAllTimeEarned(t => t + revenue);
            
            if (business.hasManager) {
              return { ...business, progress: 0, isRunning: true, totalProfit: business.totalProfit + revenue };
            } else {
              return { ...business, progress: 0, isRunning: false, totalProfit: business.totalProfit + revenue };
            }
          }
          return { ...business, progress: newProgress };
        }
        return business;
      }));
    }, 50);
    
    return () => clearInterval(interval);
  }, [lastUpdate, speedBoost]);

  const buyUpgrade = (upgradeId) => {
    const upgrade = upgrades.find(u => u.id === upgradeId);
    if (!upgrade.bought && upgrade.unlocked) {
      let cost = upgrade.cost;
      if (currentEvent?.effect === 'upgrade_discount' && eventEndTime > Date.now()) {
        cost = Math.floor(cost * currentEvent.discount);
      }
      
      if (cash >= cost) {
        const business = businesses.find(b => b.id === upgrade.businessId);
        if (upgrade.businessId === 0 || (business && business.owned >= upgrade.requiredCount)) {
          setCash(prev => prev - cost);
          setUpgrades(prev => prev.map(u => 
            u.id === upgradeId ? { ...u, bought: true } : u
          ));
        }
      }
    }
  };

  useEffect(() => {
    setAchievements(prev => prev.map(achievement => {
      if (achievement.claimed) return achievement;
      let completed = false;
      if (achievement.type === 'cash') {
        completed = allTimeEarned >= achievement.requirement;
      } else if (achievement.type === 'business') {
        const business = businesses.find(b => b.id === achievement.businessId);
        completed = business && business.owned >= achievement.requirement;
      } else if (achievement.type === 'managers') {
        const managersHired = businesses.filter(b => b.hasManager).length;
        completed = managersHired >= achievement.requirement;
      } else if (achievement.type === 'upgrades') {
        const upgradesBought = upgrades.filter(u => u.bought).length;
        completed = upgradesBought >= achievement.requirement;
      } else if (achievement.type === 'angels') {
        completed = investors >= achievement.requirement;
      }
      if (completed && !achievement.claimed) {
        return { ...achievement, claimed: true };
      }
      return achievement;
    }));
  }, [allTimeEarned, businesses, upgrades, investors]);

  const buySuit = (suitId) => {
    const suit = suits.find(s => s.id === suitId);
    if (!suit.owned && cash >= suit.cost) {
      setCash(prev => prev - suit.cost);
      setSuits(prev => prev.map(s => 
        s.id === suitId ? { ...s, owned: true } : s
      ));
      setSelectedSuit(suitId);
    }
  };

  const calculateInvestors = () => {
    let base = Math.floor(Math.sqrt(totalEarned / 1000000000));
    if (currentEvent?.effect === 'angel_boost' && eventEndTime > Date.now()) {
      base = Math.floor(base * currentEvent.multiplier);
    }
    return base;
  };
  const canGetInvestors = () => calculateInvestors() > investors;

  const resetForInvestors = () => {
    if (!canGetInvestors()) return;
    const newInvestors = calculateInvestors();
    const diamondBonus = prestigeUpgrades.filter(p => p.bought && (p.id === 'p4' || p.id === 'p9')).reduce((sum, p) => {
      if (p.id === 'p4') return sum + 1;
      if (p.id === 'p9') return sum + 3;
      return sum;
    }, 0);
    
    setInvestors(newInvestors);
    setDiamonds(prev => prev + diamondBonus);
    setCash(0);
    setTotalEarned(0);
    setBusinesses(prev => prev.map(b => ({
      ...b, 
      owned: b.id === 1 ? 1 : 0, 
      progress: 0, 
      isRunning: false,
      hasManager: prestigeUpgrades.find(p => p.id === 'p5')?.bought ? b.hasManager : false,
      // Keep businesses 2-5 unlocked if they were unlocked, reset 6+ based on lifetime earnings
      unlocked: b.id <= 5 ? (b.id === 1 || allTimeEarned >= b.unlockCash) : (allTimeEarned >= b.unlockCash),
      totalProfit: 0,
    })));
    setUpgrades(prev => prev.map(u => ({ ...u, bought: false })));
  };

  const formatNumber = (num) => {
    if (!isFinite(num)) return '0';
    if (num >= 1e21) return (num / 1e21).toFixed(2) + ' Sx';
    if (num >= 1e18) return (num / 1e18).toFixed(2) + ' Qi';
    if (num >= 1e15) return (num / 1e15).toFixed(2) + ' Q';
    if (num >= 1e12) return (num / 1e12).toFixed(2) + ' T';
    if (num >= 1e9) return (num / 1e9).toFixed(2) + ' B';
    if (num >= 1e6) return (num / 1e6).toFixed(2) + ' M';
    if (num >= 1e3) return (num / 1e3).toFixed(2) + ' K';
    return Math.floor(num).toLocaleString();
  };

  const formatTime = (ms) => {
    const seconds = Math.floor(ms / 1000);
    if (seconds < 1) return 'INSTANT';
    if (seconds < 60) return seconds + 's';
    const minutes = Math.floor(seconds / 60);
    if (minutes < 60) return minutes + 'm ' + (seconds % 60) + 's';
    const hours = Math.floor(minutes / 60);
    return hours + 'h ' + (minutes % 60) + 'm';
  };

  const totalProfitPerSecond = businesses.reduce((sum, b) => sum + getProfitPerSecond(b), 0);

  // Enhanced dark mode theming with better contrast
  const bgColor = darkMode ? 'bg-black' : 'bg-white';
  const textColor = darkMode ? 'text-white' : 'text-black';
  const borderColor = darkMode ? 'border-white' : 'border-black';
  const secondaryBg = darkMode ? 'bg-gray-900' : 'bg-gray-50';
  const secondaryText = darkMode ? 'text-gray-300' : 'text-gray-600';
  const cardBg = darkMode ? 'bg-gray-900' : 'bg-white';
  const hoverBg = darkMode ? 'hover:bg-gray-800' : 'hover:bg-gray-100';
  const disabledBg = darkMode ? 'bg-gray-800' : 'bg-gray-200';
  const disabledText = darkMode ? 'text-gray-500' : 'text-gray-400';
  const progressBg = darkMode ? 'bg-gray-800' : 'bg-gray-100';
  const modalBg = darkMode ? 'bg-gray-900' : 'bg-white';

  return (
    <div className={`min-h-screen ${bgColor} ${textColor} select-none`} style={{ fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif' }}>
      {showDailyBonus && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50">
          <div className={`${modalBg} p-8 rounded max-w-md text-center border-4 border-orange-600`}>
            <Gift size={48} className="mx-auto mb-4 text-orange-600" />
            <h2 className={`text-3xl font-bold mb-4 ${textColor}`}>Daily Bonus</h2>
            <p className={`text-lg mb-4 ${secondaryText}`}>Welcome back!</p>
            <div className="text-4xl font-bold text-orange-600 my-6">
              ${formatNumber(Math.floor(cash * 0.5 + 10000))}
            </div>
            <button onClick={claimDailyBonus} className="w-full bg-orange-600 py-4 text-white text-lg font-bold hover:bg-orange-700 transition-colors">
              CLAIM BONUS
            </button>
          </div>
        </div>
      )}

      {showStats && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setShowStats(false)}>
          <div className={`${modalBg} p-6 max-w-2xl w-full border-4 ${borderColor}`} onClick={e => e.stopPropagation()}>
            <h2 className={`text-3xl font-bold mb-6 flex items-center gap-2 ${textColor}`}><BarChart3 /> Statistics</h2>
            <div className="grid grid-cols-2 gap-4">
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>Cash</div>
                <div className={`text-2xl font-bold ${textColor}`}>${formatNumber(cash)}</div>
              </div>
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>$/Second</div>
                <div className="text-2xl font-bold text-green-500">${formatNumber(totalProfitPerSecond)}/s</div>
              </div>
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>Lifetime</div>
                <div className={`text-2xl font-bold ${textColor}`}>${formatNumber(allTimeEarned)}</div>
              </div>
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>Angels</div>
                <div className="text-2xl font-bold text-orange-500">{investors}</div>
              </div>
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>Diamonds</div>
                <div className="text-2xl font-bold text-cyan-400">ðŸ’Ž {diamonds}</div>
              </div>
              <div className={`border-2 ${borderColor} p-4 ${secondaryBg}`}>
                <div className={`text-sm ${secondaryText}`}>Upgrades</div>
                <div className={`text-2xl font-bold ${textColor}`}>{upgrades.filter(u => u.bought).length}/70</div>
              </div>
            </div>
          </div>
        </div>
      )}

{showPrestige && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setShowPrestige(false)}>
          <div className={`${modalBg} p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-4 ${borderColor}`} onClick={e => e.stopPropagation()}>
            <h2 className={`text-3xl font-bold mb-4 flex items-center gap-2 ${textColor}`}>
              <Rocket /> Prestige Upgrades
            </h2>
            <p className={`mb-6 ${secondaryText}`}>Spend Angels on permanent upgrades that persist through resets!</p>
            <div className="grid md:grid-cols-2 gap-3">
              {prestigeUpgrades.map(upgrade => (
                <button
                  key={upgrade.id}
                  onClick={() => buyPrestigeUpgrade(upgrade.id)}
                  disabled={upgrade.bought || investors < upgrade.cost}
                  className={`p-4 text-left border-2 ${borderColor} transition-colors ${upgrade.bought ? `${secondaryBg} ${textColor}` : investors >= upgrade.cost ? `bg-purple-900/30 ${textColor} ${hoverBg}` : `${disabledBg} ${disabledText} cursor-not-allowed`}`}
                >
                  <div className="flex justify-between items-start">
                    <div>
                      <div className={`font-bold ${upgrade.bought ? textColor : 'text-purple-400'}`}>
                        {upgrade.bought && 'âœ“ '}{upgrade.name}
                      </div>
                      <div className={`text-sm ${secondaryText}`}>{upgrade.description}</div>
                    </div>
                    <div className={`text-lg font-bold ${upgrade.bought ? disabledText : 'text-purple-400'}`}>
                      {upgrade.bought ? 'OWNED' : `ðŸ‘¼ ${upgrade.cost}`}
                    </div>
                  </div>
                </button>
              ))}
            </div>
          </div>
        </div>
      )}

      {showMilestones && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setShowMilestones(false)}>
          <div className={`${modalBg} p-6 max-w-3xl w-full max-h-[80vh] overflow-y-auto border-4 ${borderColor}`} onClick={e => e.stopPropagation()}>
            <h2 className={`text-3xl font-bold mb-4 flex items-center gap-2 ${textColor}`}>
              <Award /> Mega Milestones
            </h2>
            <p className={`mb-6 ${secondaryText}`}>Complete huge goals to earn Diamonds ðŸ’Ž</p>
            <div className="space-y-3">
              {megaMilestones.map(milestone => {
                let progress = 0;
                let current = 0;
                if (milestone.type === 'cash') {
                  current = allTimeEarned;
                  progress = Math.min((current / milestone.goal) * 100, 100);
                } else if (milestone.type === 'angels') {
                  current = investors;
                  progress = Math.min((current / milestone.goal) * 100, 100);
                }
                
                return (
                  <div key={milestone.id} className={`p-4 border-2 ${milestone.claimed ? 'border-cyan-400 bg-cyan-900/30' : `${borderColor} ${secondaryBg}`}`}>
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <div className={`font-bold text-lg ${milestone.claimed ? 'text-cyan-400' : textColor}`}>
                          {milestone.claimed && 'âœ“ '}{milestone.name}
                        </div>
                        <div className={secondaryText}>
                          {milestone.type === 'cash' ? `Earn $${formatNumber(milestone.goal)}` : `Reach ${milestone.goal} Angels`}
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="text-cyan-400 font-bold text-xl">ðŸ’Ž +{milestone.reward}</div>
                        {milestone.claimed && <div className="text-green-500 text-sm">CLAIMED</div>}
                      </div>
                    </div>
                    {!milestone.claimed && (
                      <div className={`h-3 ${progressBg} border ${borderColor} overflow-hidden`}>
                        <div 
                          className="h-full bg-cyan-500 transition-all"
                          style={{ width: `${progress}%` }}
                        />
                      </div>
                    )}
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      )}

      {showAchievements && (
        <div className="fixed inset-0 bg-black/90 flex items-center justify-center z-50 p-4" onClick={() => setShowAchievements(false)}>
          <div className={`${modalBg} p-6 max-w-2xl w-full max-h-[80vh] overflow-y-auto border-4 ${borderColor}`} onClick={e => e.stopPropagation()}>
            <h2 className={`text-3xl font-bold mb-6 flex items-center gap-2 ${textColor}`}><Trophy /> Achievements</h2>
            <div className="space-y-3">
              {achievements.map(achievement => (
                <div key={achievement.id} className={`p-4 border-2 ${achievement.claimed ? 'border-orange-600 bg-orange-900/30' : `${borderColor} ${secondaryBg}`}`}>
                  <div className="flex justify-between">
                    <div>
                      <div className={`font-bold text-lg ${textColor}`}>{achievement.claimed && 'ðŸ†'} {achievement.name}</div>
                      <div className={`text-sm ${secondaryText}`}>{achievement.description}</div>
                      <div className="text-xs text-orange-500 mt-1">+{((achievement.reward - 1) * 100).toFixed(0)}% profit boost</div>
                    </div>
                    {achievement.claimed ? <span className="text-green-500 text-2xl">âœ“</span> : <span className={`${disabledText} text-2xl`}>ðŸ”’</span>}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* Header */}
      <div className="border-b-4 border-white bg-black text-white">
        <div className="max-w-7xl mx-auto px-4 py-6">
          <div className="flex justify-between items-center">
            <div>
              <h1 className="text-5xl font-black tracking-tight">ðŸ’Ž DIAMOND CAPITALIST</h1>
              <p className="text-lg mt-2 text-gray-300">Build your diamond empire</p>
            </div>
            <button 
              onClick={() => setDarkMode(!darkMode)}
              className="px-4 py-4 border-2 border-white hover:bg-white hover:text-black transition-colors font-bold"
            >
              {darkMode ? <Sun size={24} /> : <Moon size={24} />}
            </button>
          </div>
        </div>
      </div>

      {/* Random Event Banner */}
      {currentEvent && eventEndTime > Date.now() && (
        <div className="bg-orange-600 text-white border-b-2 border-black">
          <div className="max-w-7xl mx-auto px-4 py-3">
            <div className="flex justify-between items-center">
              <div className="flex items-center gap-3">
                <Sparkles className="animate-pulse" size={24} />
                <div>
                  <div className="font-black text-lg">{currentEvent.name}</div>
                  <div className="text-sm">{currentEvent.description}</div>
                </div>
              </div>
              {currentEvent.effect !== 'instant_cash' && (
                <div className="font-bold text-xl">
                  {formatTime(eventEndTime - Date.now())}
                </div>
              )}
            </div>
          </div>
        </div>
      )}

      {/* Stats Bar */}
      <div className={`border-b-2 ${borderColor} ${secondaryBg}`}>
        <div className="max-w-7xl mx-auto px-4 py-4">
          <div className="flex flex-wrap items-center justify-between gap-4">
            <div className="flex items-center gap-8">
              <div>
                <div className={`text-xs uppercase ${secondaryText} font-bold`}>Cash</div>
                <div className={`text-3xl font-black ${textColor}`}>${formatNumber(cash)}</div>
              </div>
              <div className={`border-l-2 ${borderColor} pl-8`}>
                <div className={`text-xs uppercase ${secondaryText} font-bold`}>Per Second</div>
                <div className="text-2xl font-black text-green-500">${formatNumber(totalProfitPerSecond)}</div>
              </div>
              <div className={`border-l-2 ${borderColor} pl-8`}>
                <div className={`text-xs uppercase ${secondaryText} font-bold`}>Diamonds</div>
                <div className="text-2xl font-black text-cyan-400">ðŸ’Ž {diamonds}</div>
              </div>
              {speedBoostEnd > 0 && (
                <div className={`border-l-2 ${borderColor} pl-8`}>
                  <div className={`text-xs uppercase ${secondaryText} font-bold`}>Boost Active</div>
                  <div className="text-xl font-bold text-orange-500">âš¡ {formatTime(speedBoostEnd - Date.now())}</div>
                </div>
              )}
            </div>
            
            <div className="flex gap-2">
              {[1, 10, 100, 'MAX'].map(mult => (
                <button
                  key={mult}
                  onClick={() => setBuyMultiplier(mult)}
                  className={`px-6 py-3 font-bold border-2 ${borderColor} transition-colors ${buyMultiplier === mult ? (darkMode ? 'bg-white text-black' : 'bg-black text-white') : `${cardBg} ${textColor} ${hoverBg}`}`}
                >
                  {mult === 'MAX' ? 'MAX' : `Ã—${mult}`}
                </button>
              ))}
            </div>
            
            <div className="flex gap-3">
              <button onClick={() => setShowStats(true)} className={`px-4 py-3 ${cardBg} border-2 ${borderColor} ${hoverBg} font-bold transition-colors`}>
                <BarChart3 size={20} className={textColor} />
              </button>
              <button onClick={() => setShowMilestones(true)} className={`px-4 py-3 ${cardBg} border-2 ${borderColor} ${hoverBg} font-bold transition-colors relative`}>
                <Award size={20} className={textColor} />
                {megaMilestones.filter(m => m.claimed).length > 0 && (
                  <span className="absolute -top-1 -right-1 bg-cyan-500 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold">
                    {megaMilestones.filter(m => m.claimed).length}
                  </span>
                )}
              </button>
              <button onClick={() => setShowAchievements(true)} className={`px-4 py-3 ${cardBg} border-2 ${borderColor} ${hoverBg} font-bold transition-colors relative`}>
                <Trophy size={20} className={textColor} />
                {achievements.filter(a => a.claimed).length > 0 && (
                  <span className="absolute -top-1 -right-1 bg-orange-600 text-white text-xs rounded-full w-6 h-6 flex items-center justify-center font-bold">
                    {achievements.filter(a => a.claimed).length}
                  </span>
                )}
              </button>
            </div>
            
            <div className="text-right">
              <div className={`text-xs uppercase ${secondaryText} font-bold`}>Angels</div>
              <div className="text-2xl font-black text-orange-500">ðŸ‘¼ {investors}</div>
            </div>
          </div>
        </div>
      </div>

      <div className="max-w-7xl mx-auto p-4">
        <div className="grid lg:grid-cols-4 gap-6">
          <div className="lg:col-span-3 space-y-4">
            {businesses.filter(b => b.id <= 5 || b.unlocked).map(business => {
              const amount = buyMultiplier === 'MAX' ? getMaxBuyAmount(business) : buyMultiplier;
              const cost = getBusinessCost(business, amount);
              const revenue = getBusinessRevenue(business);
              const profitPerSec = getProfitPerSecond(business);
              const productionTime = getProductionTime(business);
              const progressPercent = (business.progress / productionTime) * 100;
              const canAfford = cash >= cost && amount > 0 && business.unlocked;
              const isInstant = productionTime < 1000;
              const isFree = nextFreeBusiness && currentEvent?.effect === 'free_business';
              const isLocked = !business.unlocked;

              return (
                <div key={business.id} className={`border-2 ${borderColor} ${isLocked ? disabledBg : cardBg} hover:shadow-lg transition-shadow ${isLocked ? 'opacity-60' : ''}`}>
                  <div className="p-4">
                    <div className="flex items-center gap-4 mb-4">
                      <div className="text-5xl relative">
                        {business.icon}
                        {isLocked && <span className="absolute -top-2 -right-2 text-2xl">ðŸ”’</span>}
                      </div>
                      <div className="flex-1">
                        <div className={`font-black text-xl ${isLocked ? disabledText : textColor}`}>
                          {business.name}
                          {isLocked && <span className="text-sm ml-2 text-red-400">(LOCKED)</span>}
                        </div>
                        {isLocked ? (
                          <div className="text-sm mt-1">
                            <span className="text-orange-500 font-bold">ðŸ”“ Unlocks at ${formatNumber(business.unlockCash)}</span>
                          </div>
                        ) : (
                          <div className="flex gap-6 text-sm mt-1 flex-wrap">
                            <span className={secondaryText}>Owned: <span className={`font-bold ${textColor}`}>{business.owned}</span></span>
                            <span className={secondaryText}>Revenue: <span className="font-bold text-green-500">${formatNumber(revenue)}</span></span>
                            {business.hasManager && (
                              <span className={secondaryText}>$/s: <span className="font-bold text-orange-500">${formatNumber(profitPerSec)}</span></span>
                            )}
                            {isInstant && business.hasManager && <span className="text-orange-500 font-bold">âš¡ INSTANT</span>}
                            {business.owned >= 50 && business.owned < 100 && <span className="text-orange-500 font-bold">âš¡ 2Ã— Speed</span>}
                            {business.owned >= 100 && <span className="text-orange-500 font-bold">âš¡âš¡ 4Ã— Speed</span>}
                          </div>
                        )}
                      </div>
                      <div>
                        <button
                          onClick={() => !isLocked && buyBusiness(business.id)}
                          disabled={isLocked || (!canAfford && !isFree)}
                          className={`px-8 py-4 font-bold border-2 ${borderColor} transition-colors ${
                            isLocked 
                              ? `${disabledBg} ${disabledText} cursor-not-allowed` 
                              : (canAfford || isFree) 
                                ? 'bg-green-600 text-white hover:bg-green-700' 
                                : `${disabledBg} ${disabledText} cursor-not-allowed`
                          }`}
                        >
                          <div className="text-xs">{isLocked ? 'LOCKED' : isFree ? 'FREE!' : `BUY ${amount}`}</div>
                          <div className="text-lg">{isLocked ? 'ðŸ”’' : isFree ? 'âœ¨' : `$${formatNumber(cost)}`}</div>
                        </button>
                      </div>
                    </div>

                    {!isLocked && business.owned > 0 && (
                      <>
                        <div 
                          className={`relative h-14 border-2 ${borderColor} cursor-pointer overflow-hidden mb-3 ${isInstant && business.hasManager ? 'bg-green-200' : progressBg}`}
                          onClick={() => clickBusiness(business.id)}
                        >
                          {!isInstant && (
                            <div 
                              className={`h-full transition-all ${business.isRunning || business.hasManager ? 'bg-orange-600' : 'bg-gray-600'}`}
                              style={{ width: `${Math.min(progressPercent, 100)}%` }}
                            />
                          )}
                          <div className={`absolute inset-0 flex items-center justify-center font-bold text-lg ${darkMode ? 'text-white' : 'text-black'}`}>
                            {isInstant && business.hasManager
                              ? `âš¡ AUTO-INSTANT`
                              : business.isRunning || business.hasManager
                              ? formatTime(productionTime - business.progress)
                              : 'â–¶ CLICK TO START'}
                          </div>
                        </div>
                        <div>
                          {!business.hasManager ? (
                            <button
                              onClick={() => hireManager(business.id)}
                              disabled={cash < business.managerCost}
                              className={`w-full py-3 font-bold border-2 ${borderColor} transition-colors ${cash >= business.managerCost ? 'bg-orange-600 text-white hover:bg-orange-700' : `${disabledBg} ${disabledText} cursor-not-allowed`}`}
                            >
                              ðŸ‘” HIRE {business.managerName.toUpperCase()} - ${formatNumber(business.managerCost)}
                            </button>
                          ) : (
                            <div className={`text-center text-sm font-bold text-green-500 ${darkMode ? 'bg-green-900/30' : 'bg-green-50'} py-3 border-2 border-green-600`}>
                              âœ“ {business.managerName.toUpperCase()} MANAGING
                            </div>
                          )}
                        </div>
                      </>
                    )}
                    
                    {isLocked && (
                      <div className={`text-center py-8 ${secondaryBg} border-2 ${borderColor} mt-3`}>
                        <div className="text-4xl mb-2">ðŸ”’</div>
                        <div className={`font-bold ${secondaryText}`}>Reach ${formatNumber(business.unlockCash)} to unlock</div>
                      </div>
                    )}
                  </div>
                </div>
              );
            })}
            
            {businesses.filter(b => b.id > 5 && !b.unlocked).length > 0 && (
              <div className={`text-center p-8 ${secondaryBg} border-2 ${borderColor}`}>
                <TrendingUp size={48} className={`mx-auto mb-4 ${secondaryText}`} />
                <div className={`text-xl font-bold ${secondaryText}`}>Next Business Unlocks at</div>
                <div className={`text-3xl font-black mt-2 ${textColor}`}>${formatNumber(businesses.find(b => b.id > 5 && !b.unlocked)?.unlockCash || 0)}</div>
              </div>
            )}
          </div>

          <div className="space-y-4">
            <div className={`bg-orange-600 text-white p-4 border-2 ${borderColor}`}>
              <h2 className="text-xl font-black mb-4 flex items-center gap-2">
                <Zap /> BOOSTS
              </h2>
              <button
                onClick={() => activateSpeedBoost(60000)}
                disabled={speedBoostEnd > 0}
                className={`w-full py-3 font-bold border-2 border-white mb-3 transition-colors ${speedBoostEnd > 0 ? 'bg-gray-500 text-gray-300 cursor-not-allowed' : 'bg-white text-black hover:bg-gray-100'}`}
              >
                âš¡ 2Ã— Speed (60s)
              </button>
              <label className="flex items-center gap-2 cursor-pointer bg-white text-black p-3 border-2 border-white mb-3">
                <input type="checkbox" checked={autoManager} onChange={(e) => setAutoManager(e.target.checked)} className="w-5 h-5" />
                <span className="text-sm font-bold">Auto-Hire Managers</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer bg-white text-black p-3 border-2 border-white mb-3">
                <input type="checkbox" checked={autoBuyerEnabled} onChange={(e) => setAutoBuyerEnabled(e.target.checked)} className="w-5 h-5" />
                <span className="text-sm font-bold">Auto-Buy Businesses</span>
              </label>
              <label className="flex items-center gap-2 cursor-pointer bg-white text-black p-3 border-2 border-white">
                <input type="checkbox" checked={autoUpgradeEnabled} onChange={(e) => setAutoUpgradeEnabled(e.target.checked)} className="w-5 h-5" />
                <span className="text-sm font-bold">Auto-Buy Upgrades</span>
              </label>
            </div>

            <div className={`${cardBg} p-4 border-2 ${borderColor}`}>
              <h2 className={`text-xl font-black mb-4 flex items-center gap-2 ${textColor}`}>
                <Gem /> Diamond Shop
              </h2>
              <div className="space-y-2 max-h-80 overflow-y-auto">
                {diamondUpgrades.map(upgrade => (
                  <button
                    key={upgrade.id}
                    onClick={() => buyDiamondUpgrade(upgrade.id)}
                    disabled={upgrade.bought || diamonds < upgrade.cost}
                    className={`w-full p-3 text-left border-2 ${borderColor} transition-colors ${upgrade.bought ? `${secondaryBg} ${textColor}` : diamonds >= upgrade.cost ? `bg-cyan-900/30 ${textColor} ${hoverBg}` : `${disabledBg} ${disabledText} cursor-not-allowed`}`}
                  >
                    <div className="flex justify-between items-start">
                      <div>
                        <div className={`font-bold text-sm ${upgrade.bought ? textColor : 'text-cyan-400'}`}>
                          {upgrade.bought && 'âœ“ '}{upgrade.name}
                        </div>
                        <div className={`text-xs ${secondaryText}`}>{upgrade.description}</div>
                      </div>
                      <div className={`text-sm font-bold ${upgrade.bought ? disabledText : 'text-cyan-400'}`}>
                        {upgrade.bought ? 'OWNED' : `ðŸ’Ž ${upgrade.cost}`}
                      </div>
                    </div>
                  </button>
                ))}
              </div>
            </div>

            <div className={`${cardBg} p-4 border-2 ${borderColor}`}>
              <h2 className={`text-xl font-black mb-4 flex items-center gap-2 ${textColor}`}>
                <ShoppingBag /> SUITS
              </h2>
              <div className="space-y-2">
                {suits.map(suit => (
                  <button
                    key={suit.id}
                    onClick={() => suit.owned ? setSelectedSuit(suit.id) : buySuit(suit.id)}
                    disabled={!suit.owned && cash < suit.cost}
                    className={`w-full p-3 text-left border-2 ${borderColor} transition-colors ${selectedSuit === suit.id ? 'bg-orange-600 text-white' : suit.owned ? `${cardBg} ${textColor} ${hoverBg}` : cash >= suit.cost ? `${cardBg} ${textColor} ${hoverBg}` : `${disabledBg} ${disabledText} cursor-not-allowed`}`}
                  >
                    <div className="flex justify-between items-center">
                      <div>
                        <div className="text-2xl">{suit.icon}</div>
                        <div className="font-bold text-sm">{suit.name}</div>
                        <div className="text-xs">Ã—{suit.bonus} profit</div>
                      </div>
                      {suit.owned ? selectedSuit === suit.id && <span className="text-xl">âœ“</span> : <div className="text-xs font-bold text-orange-500">${formatNumber(suit.cost)}</div>}
                    </div>
                  </button>
                ))}
              </div>
            </div>

            <div className={`${cardBg} p-4 border-2 ${borderColor}`}>
              <h2 className={`text-xl font-black mb-4 ${textColor}`}>ðŸ‘¼ ANGELS</h2>
              <button
                onClick={() => setShowPrestige(true)}
                className={`w-full py-3 mb-4 font-bold border-2 border-purple-500 bg-purple-900/30 text-purple-400 hover:bg-purple-900/50 transition-colors`}
              >
                <Rocket size={20} className="inline mr-2" />
                PRESTIGE SHOP ({prestigeUpgrades.filter(p => p.bought).length}/10)
              </button>
              <div className="space-y-2 mb-4">
                <div className="flex justify-between text-sm">
                  <span className={secondaryText}>Current:</span>
                  <span className={`font-bold ${textColor}`}>{investors}</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className={secondaryText}>Bonus:</span>
                  <span className="font-bold text-green-500">+{(investors * 2).toFixed(0)}%</span>
                </div>
                <div className="flex justify-between text-sm">
                  <span className={secondaryText}>Next:</span>
                  <span className="font-bold text-orange-500">+{calculateInvestors() - investors}</span>
                </div>
              </div>
              <button
                onClick={resetForInvestors}
                disabled={!canGetInvestors()}
                className={`w-full py-4 font-bold border-2 ${borderColor} transition-colors ${canGetInvestors() ? 'bg-orange-600 text-white hover:bg-orange-700' : `${disabledBg} ${disabledText} cursor-not-allowed`}`}
              >
                {canGetInvestors() ? 'ðŸ‘¼ CLAIM ANGELS' : 'Need $1B Lifetime'}
              </button>
            </div>

            <div className={`${cardBg} p-4 border-2 ${borderColor}`}>
              <h2 className={`text-xl font-black mb-4 flex items-center justify-between ${textColor}`}>
                <span>âš¡ UPGRADES</span>
                <span className="text-sm">{upgrades.filter(u => u.bought).length}/70</span>
              </h2>
              <div className="space-y-2 max-h-96 overflow-y-auto">
                {upgrades.filter(upgrade => {
                  if (upgrade.bought) return false;
                  // Show unlocked upgrades and up to 5 locked ones
                  return true;
                }).slice(0, 20).map(upgrade => {
                  const business = businesses.find(b => b.id === upgrade.businessId);
                  const hasRequiredBusinesses = upgrade.businessId === 0 || (business && business.owned >= upgrade.requiredCount);
                  const isUnlocked = upgrade.unlocked;
                  const canAfford = cash >= upgrade.cost && hasRequiredBusinesses && isUnlocked;
                  
                  let displayCost = upgrade.cost;
                  if (currentEvent?.effect === 'upgrade_discount' && eventEndTime > Date.now() && isUnlocked) {
                    displayCost = Math.floor(upgrade.cost * currentEvent.discount);
                  }
                  
                  return (
                    <button
                      key={upgrade.id}
                      onClick={() => isUnlocked ? buyUpgrade(upgrade.id) : null}
                      disabled={!canAfford}
                      className={`w-full p-3 text-left border-2 ${borderColor} transition-colors ${
                        !isUnlocked 
                          ? `${disabledBg} ${disabledText} cursor-not-allowed` 
                          : canAfford 
                            ? `${darkMode ? 'bg-orange-900/30' : 'bg-orange-50'} ${textColor} ${hoverBg}` 
                            : `${secondaryBg} ${disabledText} cursor-not-allowed`
                      }`}
                    >
                      <div className="flex justify-between items-start">
                        <div className="flex-1">
                          <div className={`font-bold text-sm flex items-center gap-2 ${!isUnlocked ? disabledText : canAfford ? textColor : disabledText}`}>
                            {!isUnlocked && 'ðŸ”’ '}
                            {upgrade.name}
                          </div>
                          <div className={`text-xs ${secondaryText}`}>{upgrade.description}</div>
                          {!isUnlocked ? (
                            <div className="text-xs text-red-400 mt-1">
                              Unlocks at ${formatNumber(upgrade.unlockCash)}
                            </div>
                          ) : !hasRequiredBusinesses ? (
                            <div className="text-xs text-yellow-400 mt-1">
                              Need {upgrade.requiredCount} {businesses.find(b => b.id === upgrade.businessId)?.name}
                            </div>
                          ) : (
                            <div className="text-sm font-bold text-orange-500 mt-1">
                              ${formatNumber(displayCost)}
                              {currentEvent?.effect === 'upgrade_discount' && eventEndTime > Date.now() && (
                                <span className="ml-2 text-xs">ðŸ·ï¸ 50% OFF!</span>
                              )}
                            </div>
                          )}
                        </div>
                      </div>
                    </button>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <style jsx>{`
        .select-none {
          user-select: none;
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
        }
      `}</style>
    </div>
  );
};

export default DiamondCapitalist;
